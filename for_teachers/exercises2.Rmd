---
title: "II. Working with data in R (exercises)"
author: "Data Science Lab, University of Copenhagen"
date: "`r format(Sys.time(), '%d %B, %Y')`"
output:
  html_document: default
  pdf_document: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, eval = FALSE)
```

### Setting up

0. For working on the exercise, create a new Rscript with a descriptive name and save it where you can find it again, i.e. in the folder where you downloaded the teaching material.

### Importing data and a first look at the dataset 


The data set used in these exercises was compiled from data downloaded from the website of the UK's national weather service, the [*Met Office*](http://www.metoffice.gov.uk/public/weather/climate-historic/). It is saved in the file 
**climate.xlsx**^[Contains public sector information licensed under the [Open Government Licence v3.0](http://www.nationalarchives.gov.uk/doc/open-government-licence/version/3/).].
The spreadsheet contains data from five UK weather stations. The following variables are included in the data set:

| Variable name | Explanation |
|-|-|
| **station** | Location of weather station | 
| **year** | Year |
| **month** | Month |
| **af** | Days of air frost |
| **rain** | Rainfall in mm |
| **sun** | Sunshine duration in hours |
| **device** | Brand of sunshine recorder / sensor |


1.  Start by importing the dataset using the `read_excel()` function. Make sure you have the `readxl` package loaded in your new script and have executed the line. Also, check that R can "see" the excel file, i.e. either set your working directory or specify the path to the file. 

2.  Write the name you have given the dataframe, i.e. `climate`, into the console and press enter to see the first lines of the dataset. You can also click on the `climate` object in the Environment panel.

3. Explore your dataset and understand what data you have.

    a. How many observations are there?

    b. How many data columns are there and what are their types?

    c. How many different stations are there?

    d. How many observations per station?


### Working with the data

Before you proceed with the exercises in this document, make sure you load the `tidyverse` in order to use the functions from this package.

4. Select from the climate dataset:

    a. all rows from the station in Oxford

    b. all rows from the station in Oxford when there were at least 100 hours of sunlight

    c. all rows from the stations in Oxford and Camborne when there were at least 100 hours of sunlight 

    d. a subset that only contains the `station`, `year` and `rain` columns

The next few questions build on each other, each adding a piece of code:

5. Compute the average rainfall over the full dataset by using the `summarize` function. You can look at the examples we did at the end of presentation 2.

6. Now, add to this calculating also the standard deviation of the rainfall as well as the total rainfall (the sum). I.e. all three measures should be inside the same resulting table. Have a look at the tidyverse lecture if you have trouble with this.

7. Now, use `group_by` before `summarize` in order to compute group summary statistics (average, standard deviation, and sum) for each of the five weather stations. 

8. Include a column in the summary statistics which shows how many observations the data set contains for each station.
    
9. Sort the rows in the output in descending order according to annual rainfall.

### Manipulating the data

10. Create a new copy of the climate dataset to which you have added a column that states the amount of hours with no sunshine for each month. A month has on average 730 hours, you can use the same amount of hours for all of them to calculate the new column.

11. Add another column to your new dataset that says whether the weather this month was good. We consider a month to be good if it had at least 50 hours of sunlight and less than 100 mm of rain. Otherwise the weather was bad.

12. Count the number of months per station that did not have any days with air frost.

13. Count the number of months with good weather per station (use the column you made in 10). What's the place with the best weather in England? 

### Complex operations

The final questions require that you combine commands and variables of the type above.

14. Identify the weather station for which the median number of monthly sunshine hours over the months April to September was largest.

15. For each weather station apart from the one in Armagh, compute the total rainfall and sunshine duration during the months with no days of air frost. Present the totals in centimetres and days, respectively.

16. For each month, count how many stations recorded at least two days of air frost or more than 95 mm rain. Tip: Think about how you can do that with `filter` and `summarize`. Then, for these data lines compute the average number of sunshine hours split up by month.


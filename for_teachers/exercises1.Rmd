---
title: "I. Working with data in R (exercises)"
author: "Science Data Lab & Center for Health Data Science"
date: "`r format(Sys.time(), '%d %B, %Y')`"
output:
  #pdf_document: default
  html_document: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, eval = FALSE)
```

## Getting started

* Start RStudio.

* Make a new *R-project*. You can either make one in a brand new folder or make one in an already existing folder. For this exercise purpose, we will create a new folder.   
Go to the menu bar and click *file* &#8594; *New project...* &#8594; *New Directory* &#8594; *New Project*. **NOW**, make sure you know where you place your folder. Name your directory (folder), then click *Browse* to place your new folder and project somewhere you can find it again.


* Lets check which working directory we are in. We do this with `getwd()`(you do not need to put anything in the parenthesis).

* *IF* you want to change your working directory you can do this with `setwd("path/my.folder")` or by clicking *Session* &#8594; *Set Working Directory* &#8594; *Choose Directory...*.
\


## Write commands at the prompt

1. Go to the R console (lower left window) and write a few commands, **one at a time**. You could for example try thee commands: 
```{r results='hide'}
6*12
x <- 100
x + 7
```

Notice how a new object, *x*, appears in the Global Environment window (upper right window) and can be used for new computations. 

**Commands written in the console are not saved for later use!** It is totally fine to write commands that should not be used again or quickly tested at the directly in the console, but in general you must organize your commands in R scripts (or R Markdown files, which will be introduced in Lesson IV).
\

## Working with R scripts

One option is to write your commands in an R script. An R script is just a file with R commands and it usually has file extension .R.
\

2. Start by opening a new R script by clicking *File* &#8594; *New File* &#8594; *R Script*. (You can also make new script simply by clicking the *icon with the green plus* at the top most right of the Rstudio editor). 
\

3. Write a command in the file, similar to one of those from above. Click *Run* - or even easier - type *Ctrl + Enter*. Then the command is transferred to the console window and executed, just as if you write the command at the prompt directly. Try with a new command in a new line.
\

4. Put a hashtag (#) before one of the commands and run it. Nothing happens! Hence, you can use hashtags for writing comments in your scripts. 
\

5. Save the document in the folder you have designated for your R work (*File* &#8594; *Save As*) so that you can use it another time. When you save an R script it should be given the file extension *.R*. Thus, you might choose to call the file *solution1.R*.

**Save your files often.** It happens that you ask R for something so weird that it shuts down, and then it is a pity to have lost your work.
\

## Making some graphics

Let's also try to make some plots using the base graphics system in R (in *Presentation III* you will learn to make graphics using the *ggplot2*-package).
\

6. First we need something to plot, that is a dataset. R has some built in datasets, which may be loaded using the command `data`. Insert the following two commands in your R script, and execute them (if you forgot how to do this, then see question 3 above) to learn about the *trees* dataset. Here the prefix `?` in the second command opens a help page in the lower-right window.
```{r eval=FALSE}
data(trees)
View(trees)
?trees
```
\

7. The dataset *trees* contains 31 observations of 3 variables (diameter, height and volume of black cherry trees). Insert the following two commands in your R script, and execute them to make two plots. Thereafter click *"Plots"* in the lower-right window, and use the arrows to toggle between the two plots you just made. What is the difference between these three plots?

```{r eval=FALSE}
plot(Volume~Height, data=trees)
plot(Volume~Height, data=trees, log="xy")
plot(log(Volume)~log(Height), data=trees)
```


## Shut down R

8. Close RStudio. If changes were made either to the R script (shown in the upper-left window) or to the workspace (called 'Global Environment' in the upper-right window) you will be prompted if you would like to save those. Answer *Yes* to that. It is **important** that you save your R scripts (or Markdown documents) as they contain all relevant commands to reproduce your output and plots.
\

9. Locate the R script that you saved in question 5 (and that presumably was re-saved in question 8); that would be the file *solution1.R* if you followed our name suggestion in question 5. Start RStudio again, and open the file (via the File menu). Check that you can run it again. 
\

Remark - when you work locally on your laptop you can also start RStudio by double clicking on a file with .R (or .Rmd) extension. One advantage of this is that the workspace and the R history will be saved to the same folder as the R script when you later close RStudio, since the _working directory_ will be set to the folder where the file is located. 
\

<!-- - Requires that *.R* files are associated to RStudio. If *.R* files are not associated to RStudio, then you can achieve this by right clicking on the file. -->


## R Packages

R is born with a lot of functionalities, but the enormous community of R users also contributes to R all the time by developing code and sharing it in R packages. An R package is a collection of R functions and/or datasets (including documentation).

An R package needs be _downloaded_, _installed_ and _loaded_ before you can use its functionalities. You only have to download and install a package once (until you re-install R), whereas you have to load it in every R session you want to use it. 
\

10. Installation. There are a couple of ways to do this. You can either (a) click your way to an installation, or (b) run the command `install.packages("PackageName")`:   
a. Click on the _Packages_ tab (next to the _Plots_ tab where your plot of the trees data shoould have appeared), then click _Install_. You will get a little pop-up window. In the first drop-down menu choose _CRAN_ as your source, then write the package name i.e. `vegan` into _Packages_, and click _Install_.   
b. Type or copy `install.packages("vegan")` into the console directly and hit enter. You do not need to save this command as package installation is usually a one time thing, but, if you would like to, simply add it to your R script.   

A lot of red text is written in the console while the installation goes on. In the end, the package is installed. 
\

11. Loading: Load the package with the command `library(vegan)`. If everything went well, you should now able to run the command `data(package = 'vegan')` which will show you an overview of the datasets included in the package.
\

## Functions & Help Pages

Every R function comes with a help page, that gives a brief description of the function and describes its usage (input/arguments and output/value). Let's use the function `median` as example. It is, no surprise, computing the median from a vector of numbers. 
\

12. Try these commands:
```{r, results="hide"}
x <- c(1,3,8,9,100,NA)
x
median(x)
```
The first command defines a vector with six elements, but where the last number is missing (NA = Not Available). Since the last number is missing, `median` returns `NA`. However, could we make `median` find the median of the remaining numbers. Perhaps the help page can help out!
\

13. Try the command
```{r}
?median
```
Then the help page for `median` appears in the lower left window. If we read it carefully, then we realize that the extra argument (input) `na.rm` may help us. We therefore try this:
```{r}
median(x, na.rm=TRUE)
```
\

14. Have a look at **slides 16-17 in the slideshow**, and try out some of the functions (`sum`, `log`, `var`, etc.) on one, or more, of the variables from the trees dataset.   
**N.B** first you will need to extract and save these variables as vectors, we do this using the `$` symbol as shown below for the variable `Height`:

```{r}
height_vector <- trees$Height
```
\

15. Bonus questions. How do you extract only elements/values `2 to 5` from the `Girth` variable in the trees dataset? Hint: Use the dollar operator and slicing.
\

R help pages are sometimes difficult to read, but be aware that there are examples of commands in the bottom of each help page. For more complicated functions, these examples can be very useful while trying to get to know the function and its functionalities. 

In order to use the help pages as above, you need to know the name of the function, which obviously may not be the case: You want to compute the median but have no idea what function to use. The best way to proceed: Google! Use "R whatever-you-want-to-search-for", and you often get exactly what you need. 
\


## Lessons learnt

* You must work with R scripts (or with R Markdown) such that you can save the work and return to it some other day. The course material is written in Markdown, but you can make the exercises with R scripts if you prefer - and at least until you will have learnt how to use Markdown.

* Save your files often.

* If you forget to save your files before you close RStudio, then RStudio will prompt you if you want to save your work. 

* Write comments to yourself along the way, so you can later remember why you did as you did. In R scripts this is done using hashtags (#).


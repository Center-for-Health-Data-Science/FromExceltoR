---
title: "IV. R Markdown (presentation)"
author: "Center for Health Data Science, University of Copenhagen"
date: "`r format(Sys.time(), '%d %B, %Y')`"
output:
  html_document: default
  pdf_document: default
---

This document does not include much, because we will simply review some features along the way. You are encouraged to work with the exercises (which include explanations) and ask us questions either during the course or later.

<!-- this is an Rmd comment  and it will NOT appear in the final output document -->

<!-- Below is a code chunk starting with ```{r  -->
<!-- r specifies the language, the rest are options -->
```{r, setup, include=FALSE}
# These additional details/comments within chunks will NOT appear in the final output document and does not affect how our code is run/executed as we used the comment/hashtag (#) sign before the text
# "setup" is the chunk-label that the user (i.e. you) defined, we call this one the setup chunk as we are setting up a default for the whole RmD code i.e. global options - Knitr will treat each option that you pass to knitr::opts_chunk$set as a global default that can be overwritten in individual chunk headers.
# Hence, the chunk named "setup" will be run automatically once before any other code is run when knitting.

# With the line of code below - we are setting up the default for the whole RmD file as echo=TRUE, unless specified otherwise (i.e. echo=FALSE) in the specific chunk (you can see an example below in the section "Options in R chunks"). "echo" is an option defining whether the source code will be shown in the output.
knitr::opts_chunk$set(echo = TRUE) 

# Additional definitions for some common options used in Rmarkdown:
# include = FALSE prevents code and results (i.e. the chunk) from appearing in the finished file. R Markdown still runs the code in the chunk, and the results can be used by other chunks.
# echo = FALSE prevents code, but not the results from appearing in the finished file. This is a useful way to embed figures.
# message = FALSE prevents messages that are generated by code from appearing in the finished file.
# warning = FALSE prevents warnings that are generated by code from appearing in the finished file.
# etc...

# Also, alternatively, the wheel menu in top right corner of the code chunk is also very useful for defining settings!

# More details on Rmarkdown here https://raw.githubusercontent.com/rstudio/cheatsheets/master/rmarkdown-2.0.pdf 
```

<!-- you can include links like this: [text](url) -->
The [R Markdown cheat sheet](https://rstudio.com/wp-content/uploads/2015/02/rmarkdown-cheatsheet.pdf)

The [R Markdown tutorial by R Studio](https://rmarkdown.rstudio.com/lesson-1.html)

The tutorial we are going through now, and the exercise you will do with R markdown will cover the following:

<!-- unordered list of items -->
* Open new markdown document, look at its structure. Knit!
* Change some text, headers, etc.
* R chunks: Knit, run code without knitting, good practice
* Options in R chunks
* Tables
* Other output formats: docx, pdf, latex (Using the dropdown menu by the Knit button)
* Good practice: See the list in the end of the document with exercises

<!-- this is a third-level heading defined by the number of "#" before the heading, see examples here https://www.rstudio.com/wp-content/uploads/2015/02/rmarkdown-cheatsheet.pdf -->
### some more text formatting
You can easily use *italic* text and **bold** text. You can also mark text as `inline code`.

---

## Some simple commands

```{r}
11 * 5
sqrt(25)
plot(trees)
```

---

## Options in R chunks

It is possible to control if code and/or output is shown in the knitted document. 

First, some code with the default settings (both code and output shown): 


```{r}
reg <- lm(Volume ~ Girth, data=trees)
summary(reg)$coefficients
```

Then exactly the same code, but now with the code suppressed. This done with the option `echo=FALSE` (not visible in the output). The easiest thing is to insert such options via the small wheel in the upper right corner of the R chunk. 

```{r, echo=FALSE}
reg <- lm(Volume ~ Girth, data=trees)
summary(reg)$coefficients
```

---


### Example: `table1`

The html output format plays well together with certain facilities for table generation. There is a function called `table1` which easily generates a table of statistics for variables of a dataset, possibly stratified after other variables in the dataset. The `table1` function is in a package with the same name. 

We first (install and) load the package and import the **downloads** data. (I inserted an option such that we don't get messages about loading of packages). Note: You may need to adjust the path for the file downloads.xlsx to import the dataset. You can do this manually or via the "Files" tab in the bottom right window of Rstudio.

<!-- message=FALSE avoids package loading messages -->
```{r, message=FALSE}
# install.packages("table1")
library(table1)
library(readxl)
downloads <- read_excel("./data/downloads.xlsx")
```


We then make an unstratified table (first) and a table stratified by machine name (second):
```{r}
# Unstratified table
table1(~ size + time, data=downloads)

# Stratified table
table1(~ size + time | machineName, data=downloads)
```

Notice that the table1 function generates html-output only, and it cannot be used with MS Word or pdf output. Therefore, look at the corresponding html file to see the content.





